<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Clash-Royale</title>
<style>
:root{--bg:#0b1220;--panel:#111827;--accent:#ffcc33;--muted:#9aa4b2;--player:#44b3ff;--enemy:#ff7b7b;--health:#8be78b;--enemyHealth:#ffb86b}
html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);display:flex;align-items:center;justify-content:center;color:white}
.app{width:1000px;max-width:98vw;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:12px;padding:18px;box-shadow:0 6px 30px rgba(0,0,0,0.6)}
header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
h1{font-size:24px;margin:0;color:var(--accent);}
.controls{display:flex;gap:8px;align-items:center}
button{background:var(--panel);border:1px solid rgba(255,255,255,0.04);color:white;padding:8px 12px;border-radius:8px;cursor:pointer;transition:0.2s}
button:hover{background:rgba(255,255,255,0.08)}
.stage{background:#0c1727;border-radius:8px;padding:12px;display:flex;gap:12px;position:relative;box-shadow:inset 0 0 12px rgba(0,0,0,0.6)}
canvas{background:linear-gradient(180deg,#0f1b2b,#07101a);border-radius:6px;display:block;cursor:crosshair;}
.sidebar{width:280px;display:flex;flex-direction:column;gap:10px}
.panel{background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;min-height:48px;box-shadow:0 2px 8px rgba(0,0,0,0.2)}
.elixirBar{height:20px;border-radius:8px;background:rgba(255,255,255,0.03);position:relative;overflow:hidden;margin-top:6px}
.elixirFill{position:absolute;left:0;top:0;height:100%;background:linear-gradient(90deg,#ffd967,#ffcc33);transition:0.2s;width:0%}
.cards{display:flex;gap:8px;flex-wrap:wrap}
.card{flex:1;background:rgba(255,255,255,0.05);border-radius:8px;padding:10px;text-align:center;cursor:pointer;transition:0.2s;user-select:none;box-shadow:0 2px 6px rgba(0,0,0,0.3)}
.card img{width:50px;height:50px;display:block;margin:0 auto 5px;}
.card:hover{background:rgba(255,255,255,0.1);transform:translateY(-2px);}
.card.disabled{opacity:0.4;cursor:not-allowed;transform:none;}
.center{display:flex;align-items:center;justify-content:center}
.muted{color:var(--muted);font-size:13px}
footer{margin-top:12px;font-size:12px;color:var(--muted);text-align:center}
</style>
</head>
<body>
<div class="app">
<header>
<h1>Clash-Royale</h1>
<div class="controls">
<div class="muted">Drag & deploy troops · Real-time combat</div>
<button id="resetBtn">Restart</button>
<button id="shareBtn">Share URL</button>
</div>
</header>
<div class="stage">
<canvas id="game" width="700" height="420"></canvas>
<div class="sidebar">
<div class="panel">
<div class="muted">Elixir</div>
<div id="elixirText">0 / 10</div>
<div class="elixirBar"><div id="elixirFill" class="elixirFill"></div></div>
</div>
<div class="panel">
<div class="muted" style="margin-bottom:6px">Cards</div>
<div class="cards">
<div id="card1" class="card"><img src="https://i.imgur.com/4QpQyRU.png" alt="Knight">Knight<br><small class="muted">Cost: 4</small></div>
<div id="card2" class="card"><img src="https://i.imgur.com/ZXq7K6n.png" alt="Archer">Archer<br><small class="muted">Cost: 3</small></div>
<div id="card3" class="card"><img src="https://i.imgur.com/NcQvTqH.png" alt="Giant">Giant<br><small class="muted">Cost: 6</small></div>
<div id="card4" class="card"><img src="https://i.imgur.com/pxn6W9X.png" alt="Fireball">Fireball<br><small class="muted">Cost: 5</small></div>
</div>
</div>
<div class="panel center" id="statusPanel">Status: <span id="statusText">Playing</span></div>
<div class="panel muted">Drag a card onto battlefield to deploy troops or cast spells. Troops now attack each other automatically.</div>
</div>
</div>
<footer>Clash-Royale — Playable in browser</footer>
</div>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const elixirText = document.getElementById('elixirText');
const elixirFill = document.getElementById('elixirFill');
const statusText = document.getElementById('statusText');
const resetBtn = document.getElementById('resetBtn');
const shareBtn = document.getElementById('shareBtn');
const cardEls = [document.getElementById('card1'), document.getElementById('card2'), document.getElementById('card3'), document.getElementById('card4')];

let game = null;
function clamp(v,a,b){return Math.max(a,Math.min(b,v));}

class Entity{
  constructor(x,y,r,opts={}){
    this.x=x;this.y=y;this.r=r;this.hp=opts.hp||10;this.maxHp=this.hp;
    this.owner=opts.owner||'player';
    this.atk=opts.atk||4;this.speed=opts.speed||1;this.range=opts.range||0;
    this.type=opts.type||'troop';this.unitType=opts.unitType||'';
    this.lane=opts.lane||'left';this.alive=true;
    this._atkTimer=0;
  }
  takeDamage(d){this.hp-=d;if(this.hp<=0){this.hp=0;this.alive=false;}}
}

class Game{
  constructor(){
    this.w=canvas.width; this.h=canvas.height;
    this.lanes={left:this.h*0.28,right:this.h*0.72};
    this.reset();
  }
  reset(){
    this.time=0; this.state='playing';
    this.elixir=5; this.elixirMax=10; this.elixirRegen=1;
    this.entities=[];
    this.spawnCooldowns={card1:0,card2:0,card3:0,card4:0};
    this.aiTimer=0;
    this.status='Playing';
    this.towers={
      playerLeft:{x:80,y:this.lanes.left,hp:100,max:100},
      playerKing:{x:80,y:this.h/2,hp:200,max:200},
      playerRight:{x:80,y:this.lanes.right,hp:100,max:100},
      enemyLeft:{x:this.w-80,y:this.lanes.left,hp:100,max:100},
      enemyKing:{x:this.w-80,y:this.h/2,hp:200,max:200},
      enemyRight:{x:this.w-80,y:this.lanes.right,hp:100,max:100}
    };
  }
  spawnTroop(cardIndex,lane,owner='player',x=null,y=null){
    const costs=[4,3,6,5];
    if(owner==='player' && this.elixir<costs[cardIndex]) return false;
    if(this.spawnCooldowns['card'+(cardIndex+1)]>0) return false;
    let def = {};
    switch(cardIndex){
      case 0: def={hp:120,atk:18,speed:1.6,r:12,type:'knight'}; break;
      case 1: def={hp:60,atk:12,speed:1.4,r:9,range:120,type:'archer'}; break;
      case 2: def={hp:200,atk:28,speed:0.9,r:16,type:'giant'}; break;
      case 3: def={hp:80,atk:50,speed:0,r:14,type:'fireball'}; break;
    }
    const px = x!==null? x : (owner==='player'?120:this.w-120);
    const py = y!==null? y : this.lanes[lane];
    const ent = new Entity(px,py,def.r,{hp:def.hp,atk:def.atk,speed:def.speed,range:def.range||0,owner:owner});
    ent.unitType=def.type; ent.lane=lane;
    this.entities.push(ent);
    if(owner==='player'){this.elixir-=costs[cardIndex]; this.spawnCooldowns['card'+(cardIndex+1)]=0.5;}
    return true;
  }
  update(dt){
    this.time+=dt; this._regenTimer=(this._regenTimer||0)+dt;
    if(this._regenTimer>=this.elixirRegen){this._regenTimer=0;this.elixir=clamp(this.elixir+1,0,this.elixirMax);}
    for(let k in this.spawnCooldowns) this.spawnCooldowns[k]=Math.max(0,this.spawnCooldowns[k]-dt);
    this.aiTimer+=dt; if(this.aiTimer>1){this.aiTimer=0; const lane=Math.random()<0.5?'left':'right'; this.spawnTroop(Math.floor(Math.random()*3),lane,'enemy');}
    for(let e of this.entities){
      if(!e.alive) continue;
      // Target nearest enemy
      let enemies=this.entities.filter(t=>t.alive && t.owner!==e.owner);
      if(enemies.length>0){
        enemies.sort((a,b)=>Math.hypot(a.x-e.x,a.y-e.y)-Math.hypot(b.x-e.x,b.y-e.y));
        let target=enemies[0];
        let dist=Math.hypot(target.x-e.x,target.y-e.y);
        if(dist<=(e.range||0)+e.r+target.r){
          e._atkTimer=(e._atkTimer||0)+dt;
          if(e._atkTimer>=0.5){target.takeDamage(e.atk); e._atkTimer=0;}
        }else{
          e.x+=Math.sign(target.x-e.x)*e.speed;
          e.y+=Math.sign(target.y-e.y)*e.speed;
        }
      }
    }
    this.entities=this.entities.filter(e=>e.alive);
  }
  draw(){
    ctx.clearRect(0,0,this.w,this.h);
    ctx.fillStyle='#0b2b3a'; ctx.fillRect(0,this.h*0.45,this.w,this.h*0.1);
    for(let k in this.towers){
      const t=this.towers[k];
      const isEnemy=k.startsWith('enemy');
      ctx.fillStyle=isEnemy?'#5a2b2b':'#234a2b';
      ctx.fillRect(t.x-22,t.y-28,44,44);
      ctx.fillStyle=isEnemy?'#ffb86b':'#8be78b';
      ctx.fillRect(t.x-26,t.y-35,clamp(t.hp/t.max,0,1)*52,4);
    }
    for(let e of this.entities){
      // Draw entity with image
      let imgSrc='';
      switch(e.unitType){
        case 'knight': imgSrc='https://i.imgur.com/4QpQyRU.png'; break;
        case 'archer': imgSrc='https://i.imgur.com/ZXq7K6n.png'; break;
        case 'giant': imgSrc='https://i.imgur.com/NcQvTqH.png'; break;
        case 'fireball': imgSrc='https://i.imgur.com/pxn6W9X.png'; break;
      }
      if(imgSrc){
        let img=new Image(); img.src=imgSrc;
        ctx.drawImage(img,e.x-e.r,e.y-e.r,e.r*2,e.r*2);
      }else{
        ctx.beginPath(); ctx.arc(e.x,e.y,e.r,0,Math.PI*2);
        ctx.fillStyle=e.owner==='player'?'#44b3ff':'#ff7b7b'; ctx.fill();
      }
      ctx.fillStyle='#000'; ctx.fillRect(e.x-e.r+1,e.y-e.r-7,(e.hp/e.maxHp)*(e.r*2-2),3);
    }
  }
}

function initGame(){game=new Game();}
initGame();
let last=performance.now();
function loop(t){const dt=(t-last)/1000;last=t;if(game){game.update(dt);game.draw();updateUI();}requestAnimationFrame(loop);}
requestAnimationFrame(loop);
function updateUI(){elixirText.textContent=Math.floor(game.elixir)+' / '+game.elixirMax;
elixirFill.style.width=Math.round((game.elixir/game.elixirMax)*100)+'%';
statusText.textContent=game.status;
const costs=[4,3,6,5];
cardEls.forEach((el,i)=>{if(game.elixir>=costs[i]) el.classList.remove('disabled'); else el.classList.add('disabled');});}

let draggingCard=null; let dragIdx=-1;
cardEls.forEach((el,i)=>{el.addEventListener('mousedown',()=>{if(!el.classList.contains('disabled')){draggingCard=el; dragIdx=i;}});});
document.addEventListener('mouseup',(e)=>{if(draggingCard){const rect=canvas.getBoundingClientRect();const x=e.clientX-rect.left;const y=e.clientY-rect.top; const lane=y<canvas.height/2?'left':'right'; game.spawnTroop(dragIdx,lane,'player',x,y); draggingCard=null; dragIdx=-1;}});
resetBtn.addEventListener('click',()=>{game.reset();});
shareBtn.addEventListener('click',()=>{alert('Deploy this HTML to GitHub Pages for a playable URL.');});
</script>
</body>
</html>
